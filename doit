#!/bin/bash -e
# InverSynth Development Script
# Runs the main development tasks using the conda environment directly

set -o pipefail

# Use direct path to conda environment to avoid activation issues
ENV_NAME="inver-synth"
PYTHON_PATH="/Users/jos/miniforge3/envs/$ENV_NAME/bin/python"

# Check if environment exists
if [ ! -f "$PYTHON_PATH" ]; then
    echo "âŒ Environment '$ENV_NAME' not found. Run ./setup.sh first."
    exit 1
fi

echo "ğŸ”§ Running InverSynth development tasks..."
echo "ğŸ“ Using environment: $ENV_NAME"
echo ""

# Initialize project directories
echo "ğŸ“ Initializing project directories..."
$PYTHON_PATH -m tasks.start

# Run tests
echo "ğŸ§ª Running tests..."
$PYTHON_PATH -m pytest

# Generate dataset
echo "ğŸ“Š Generating dataset..."
$PYTHON_PATH -m generators.fm_generator

# Train E2E model
echo "ğŸ§  Training E2E model..."
$PYTHON_PATH -m models.e2e_cnn

# Train spectrogram model
echo "ğŸµ Training spectrogram model..."
$PYTHON_PATH -m models.spectrogram_cnn

echo ""
echo "âœ… All tasks completed!"
